# feat: Add Comprehensive Documentation with pydata-sphinx-theme

## Overview

Set up a full documentation site for stonks using Sphinx with the pydata-sphinx-theme. The docs will cover self-hosting, SDK usage, PyTorch Lightning integration, the dashboard/server, and auto-generated API reference from existing Google-style docstrings. Deploy to GitHub Pages via GitHub Actions.

## Problem Statement / Motivation

The project currently has a 5-line README and no documentation site. Users cannot discover how to:
- Install and use the SDK
- Integrate with PyTorch Lightning
- Launch and self-host the dashboard
- Query logged data programmatically
- Understand the REST API

All 75+ functions already have Google-style docstrings — the documentation infrastructure just needs to be built to surface them.

## Proposed Solution

Use Sphinx with pydata-sphinx-theme, MyST (Markdown), and sphinx-autodoc2 (static analysis — no import needed). Deploy to GitHub Pages via the official `actions/deploy-pages` workflow.

## Technical Approach

### Dependencies

Add a `docs` dependency group to `pyproject.toml`:

```toml
[dependency-groups]
docs = [
    "sphinx>=8.0",
    "pydata-sphinx-theme>=0.16",
    "sphinx-autodoc2>=0.5",
    "sphinx-copybutton>=0.5",
    "sphinx-design>=0.6",
    "myst-parser>=4.0",
]
```

Install: `uv sync --group docs`

**Why these packages:**
- `sphinx` — documentation engine
- `pydata-sphinx-theme` — theme with dark mode, sidebar navigation, responsive layout
- `sphinx-autodoc2` — generates API docs via static analysis (no code import needed, handles optional deps like `lightning` gracefully)
- `sphinx-copybutton` — copy buttons on code blocks
- `sphinx-design` — cards, grids, tabs UI components
- `myst-parser` — write docs in Markdown instead of reStructuredText

### Directory Structure

```
docs/
  conf.py                # Sphinx configuration
  index.md               # Landing page with toctrees
  Makefile               # Build convenience (uses uv run)
  getting-started.md     # Installation + quickstart
  user-guide/
    index.md             # User guide landing
    tracking.md          # SDK: start_run, log, context manager
    lightning.md         # PyTorch Lightning: StonksLogger
    server.md            # Dashboard: stonks serve, UI features
    querying.md          # Read API: stonks.open(), Database class
    configuration.md     # DB path resolution, env vars
  self-hosting.md        # Deploying the dashboard
  rest-api.md            # All 7 REST endpoints documented
  contributing.md        # Dev setup, testing, linting
  _static/
    custom.css           # Optional theme overrides
  apidocs/               # Auto-generated by sphinx-autodoc2 (gitignored)
```

### Key Configuration (`docs/conf.py`)

```python
project = "stonks"
extensions = [
    "autodoc2",
    "myst_parser",
    "sphinx.ext.napoleon",
    "sphinx.ext.intersphinx",
    "sphinx.ext.viewcode",
    "sphinx_copybutton",
    "sphinx_design",
]

html_theme = "pydata_sphinx_theme"
html_theme_options = {
    "github_url": "https://github.com/<org>/stonks",
    "navbar_end": ["theme-switcher", "navbar-icon-links"],
    "navigation_depth": 3,
    "show_toc_level": 2,
    "pygments_dark_style": "a11y-high-contrast-dark",
    "logo": {"text": "stonks"},
}

autodoc2_packages = [{"path": "../stonks", "auto_mode": True}]
autodoc2_output_dir = "apidocs"
autodoc2_render_plugin = "myst"

napoleon_google_docstring = True
```

### GitHub Actions Deployment

```yaml
# .github/workflows/docs.yml
name: Documentation
on:
  push:
    branches: [main]
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - uses: astral-sh/setup-uv@v3
      - run: uv sync --group docs
      - run: uv run sphinx-build -b html docs docs/_build/html
      - uses: actions/upload-pages-artifact@v3
        with: { path: docs/_build/html }

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment: { name: github-pages, url: "${{ steps.deployment.outputs.page_url }}" }
    steps:
      - uses: actions/deploy-pages@v4
        id: deployment
```

Repository setup: Settings > Pages > Source = "GitHub Actions".

## Acceptance Criteria

### Documentation Content
- [x] `docs/getting-started.md` — installation (4 variants: core, lightning, server, all) + quickstart example
- [x] `docs/user-guide/tracking.md` — `start_run()`, `run.log()`, context manager, `strict` mode, `run_name`
- [x] `docs/user-guide/lightning.md` — `StonksLogger` constructor, `Trainer` integration, multi-logger setup
- [x] `docs/user-guide/server.md` — `stonks serve` CLI, UI features (experiment list, run table, metric charts, config comparison, SSE live updates)
- [x] `docs/user-guide/querying.md` — `stonks.open()`, `Database` class methods, `MetricSeries` usage
- [x] `docs/user-guide/configuration.md` — DB path resolution (param > `STONKS_DB` env > `./stonks.db`)
- [x] `docs/self-hosting.md` — full deployment guide: bare metal, systemd, Docker, reverse proxy (nginx)
- [x] `docs/rest-api.md` — all 7 endpoints with request/response examples
- [x] `docs/contributing.md` — dev setup (uv, bun), testing, linting, pre-commit, frontend build pipeline

### Infrastructure
- [x] `pyproject.toml` — add `docs` dependency group
- [x] `docs/conf.py` — full Sphinx config with pydata-sphinx-theme, autodoc2, MyST
- [x] `docs/Makefile` — build targets using `uv run sphinx-build`
- [x] `docs/index.md` — landing page with toctrees
- [x] `.github/workflows/docs.yml` — GitHub Actions deployment to GitHub Pages
- [x] `.gitignore` — add `docs/_build/` and `docs/apidocs/`
- [x] Auto-generated API reference from existing docstrings (sphinx-autodoc2)

### Verification
- [x] `uv run sphinx-build -b html docs docs/_build/html` builds without errors
- [x] `uv run sphinx-build -b html docs docs/_build/html -W` (warnings-as-errors) passes
- [ ] Local preview works: `python -m http.server -d docs/_build/html 8080`
- [ ] Dark mode toggle functional
- [x] API reference pages generated for all public modules

## Self-Hosting Documentation Content

The `self-hosting.md` page should cover these deployment scenarios:

### 1. Quick Local Usage
```bash
pip install stonks[server]
stonks serve --db ./my-experiments.db
# Open http://127.0.0.1:8000
```

### 2. Bare Metal / VM
- Install Python 3.11+, pip install stonks[server]
- Run with uvicorn directly for production: `uvicorn stonks.server.app:create_app --factory --host 0.0.0.0 --port 8000`
- Set `STONKS_DB` env var to point to the database
- Use systemd unit file for process management

### 3. Docker
- Provide a sample `Dockerfile` (python:3.11-slim, pip install stonks[server], expose 8000)
- `docker run -v /data:/data -e STONKS_DB=/data/stonks.db -p 8000:8000 stonks`

### 4. Behind Reverse Proxy (nginx)
- Sample nginx config for proxying to uvicorn
- SSE requires `proxy_buffering off` and `X-Accel-Buffering: no`

### 5. Shared Team Usage
- Point multiple training scripts to the same SQLite file (WAL mode handles concurrent writes)
- Run `stonks serve --db /shared/path/stonks.db` on a team server
- Access from any machine on the network

## Files to Create / Modify

| File | Action | Description |
|------|--------|-------------|
| `pyproject.toml` | Modify | Add `docs` dependency group |
| `docs/conf.py` | Create | Sphinx configuration |
| `docs/index.md` | Create | Landing page |
| `docs/Makefile` | Create | Build convenience |
| `docs/getting-started.md` | Create | Install + quickstart |
| `docs/self-hosting.md` | Create | Deployment guide |
| `docs/rest-api.md` | Create | API endpoint reference |
| `docs/contributing.md` | Create | Developer guide |
| `docs/user-guide/index.md` | Create | User guide landing |
| `docs/user-guide/tracking.md` | Create | SDK usage |
| `docs/user-guide/lightning.md` | Create | Lightning integration |
| `docs/user-guide/server.md` | Create | Dashboard guide |
| `docs/user-guide/querying.md` | Create | Read API |
| `docs/user-guide/configuration.md` | Create | Config/env vars |
| `docs/_static/custom.css` | Create | Theme overrides (minimal) |
| `.github/workflows/docs.yml` | Create | GH Pages deployment |
| `.gitignore` | Modify | Add docs build artifacts |

## Build Commands Reference

| Command | Purpose |
|---------|---------|
| `uv sync --group docs` | Install documentation dependencies |
| `uv run sphinx-build -b html docs docs/_build/html` | Build HTML docs |
| `uv run sphinx-build -b html docs docs/_build/html -W` | Build with warnings as errors |
| `uv run sphinx-build -b linkcheck docs docs/_build/linkcheck` | Check for broken links |
| `python -m http.server -d docs/_build/html 8080` | Preview locally at localhost:8080 |

## References

- [pydata-sphinx-theme docs](https://pydata-sphinx-theme.readthedocs.io/en/v0.16.1/)
- [sphinx-autodoc2 docs](https://sphinx-autodoc2.readthedocs.io/)
- [Sphinx official tutorial](https://www.sphinx-doc.org/en/master/tutorial/)
- [MyST parser docs](https://myst-parser.readthedocs.io/)
- [GitHub Actions: deploy-pages](https://github.com/actions/deploy-pages)
- [Publishing Sphinx to GitHub Pages (Lorna Jane, 2025)](https://lornajane.net/posts/2025/publish-to-github-pages-with-sphinx)
